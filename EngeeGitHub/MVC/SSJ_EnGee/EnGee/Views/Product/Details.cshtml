@model EnGee.ViewModel.SSJ_ProductDetailsViewModel
@*商品詳情*@
@{
    ViewBag.Title = Model.ProductName + " Details";
}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
 <style>
        .product-image-section img {
            width: auto;
            height: 426px;
            object-fit: cover;
        }
    </style>
<main>
    <div class="container py-5">
        <div class="row border-0 ">
            <div class="product-details-container d-flex">
                <div class="product-image-section col-l-4 col-md-4 col-sm-6 col-xs-8 col-8 d-flex align-items-center justify-content-center">
                    <img src="@Model.ProductImagePath" alt="@Model.ProductName Image">

                    <div class="product-details-container col-md-4 col-4  d-flex align-items justify-content-start ms-5">
                        <div class="product-info-section">
                            <h1 class="product-title">@Model.ProductName</h1>
                            <p class="product-brand">品牌: @Model.BrandName</p>
                            <p class="product-category">主分類: @Model.MainCategoryName</p>
                            <p class="product-subcategory">子分類: @Model.SubcategoryName</p>
                            <p class="product-description">商品詳情:@Model.ProductDescribe</p>
                            <p class="product-price">單價: @Model.ProductUnitPoint 點</p>
                            <p class="product-remaining-quantity">剩餘數量: @Model.ProductRemainingQuantity</p>
                            <p class="product-expiration-date">
                                過期日期:
                                @Model.ProductExpirationDate.ToShortDateString()
                            </p>
                            <p class="product-usage-status">使用狀態: @Model.ProductUsageStatus</p>

                            <div class="delivery-seller-section">
                                <p class="product-delivery-type">送貨方式: @Model.DeliveryTypeName</p>
                                <p class="product-delivery-fee">運費: NT$ @Model.DeliveryFee</p>
                                <p class="product-seller-name">賣家: @Model.SellerName</p>
                            </div>
                            <div>
                                <form id="productForm" asp-controller="Shopping" asp-action="AddToCart" method="post">
                                    <!-- Product ID (Hidden) -->
                                    <input type="hidden" name="txtProductId" value="@Model.ProductId" />
                                    <input type="hidden" name="deliveryOption" value="" class="deliveryOptionInput" />

                                    <!-- 數量 -->
                                    <div class="Purchase-quantity-section d-flex">
                                        <label for="txtCount">數量</label>
                                        <div class="col-md-10">
                                            @Html.TextBox("txtCount", "1", new { @class = "form-control" })
                                        </div>
                                    </div>

                                    <!-- 配送方式 -->
                                    <div class="choose-product-delivery-section d-flex">
                                        <div id="delyTitle">配送方式:</div>
                                        <div class="shippingList">
                                            <label><input name="deliveryType" delytype="宅配" type="radio" id="homeDelivery" checked="">宅配</label>
                                            <label><input name="deliveryType" delytype="超商/i郵箱/myfone門市取貨" type="radio" id="StorePickup">超商/i郵箱/myfone門市取貨</label>
                                        </div>
                                    </div>

                                    <!-- 行动 -->
                                    <div class="product-action-section d-flex">
                                        <button class="btn btn-m btnHoverStyle2 m-2 add-to-cart" type="button">加入購物車</button>
                                        <button class="btn btn-m btnHoverStyle2 m-2" type="submit" name="actionType" value="buyNow" class="buy-now">立即購買</button>
                                    </div>
                                </form>
                            </div>


                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<script>
    $(document).ready(function ()
    {

        // 初始化設置
        var initialDelivery = $("input[name='deliveryType']:checked").attr("delytype");
        $(".deliveryOptionInput").val(initialDelivery);

        // 當選擇配送方式時
        $("input[name='deliveryType']").on("change", function ()
        {
            var selectedDelivery = $(this).attr("delytype");
            $(".deliveryOptionInput").val(selectedDelivery);
        });

        // 當點擊 "加入購物車" 或 "立即購買" 時
        $(".add-to-cart, .buy-now").on("click", function (e)
        {
            e.preventDefault(); // 阻止預設事件

            var selectedDelivery = $("input[name='deliveryType']:checked").attr("delytype");
            var form = $("#productForm");
            $(".deliveryOptionInput", form).val(selectedDelivery);

            // 如果是 "立即購買" 就直接提交表單
            if ($(this).hasClass("buy-now"))
            {
                form.submit();
                return;
            }

            var formData = form.serialize();

            // 使用 AJAX 提交
            // 使用 AJAX 提交
            $.ajax({
                type: "POST",
                url: form.attr("action"),
                data: formData + "&deliveryOption=" + selectedDelivery, // 這裡加上 deliveryOption 參數
                success: function (response)
                {
                    alert("已加入購物車");
                },
                error: function (jqXHR, textStatus, errorThrown)
                {
                    alert("添加失敗，請稍後再試");
                }
            });
        });
    });
</script>

